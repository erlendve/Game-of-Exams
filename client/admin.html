<!-- This template generates the admin view -->
<template name="admin">
	{{#if edit}}
	{{> admin_edit_exam edit.this}} <!-- Sends the exam object (edit.this as context to the template) -->
	{{else}} <!-- / else if edit -->

	{{#unless loggingIn}}
	{{#if isAdmin}}
	{{> examlist_admin}}
	{{else}}
	<div class="alert alert-error alert-block">
		<button type="button" class="close" data-dismiss="alert">×</button>
		<h4>This page is for admins only</h4>
		This user does not have admin rights
	</div>
	{{/if}} <!-- /end ifAdmin if -->
	{{/unless}} <!-- /end loggingIn if -->

	{{/if}} <!-- /end if edit -->
</template>

<template name="examlist_admin">
	<div class="container">
		<!-- The add content element. This will be fixed to right on desktop, and displayed top on smaller screens -->
		<div class="add-new-content span2 offset10">
			<p class="lead">Add new content</p>
			<a href="#" id="add_new_course" data-toggle="modal" data-target="#modal_add_course">New course</a><br />
			<a href="/admin/newexam" class="add_new_exam">New exam</a>
		</div>
		<!-- /end add-new-content -->
		
		<p class="lead">You are admin on these courses:</p>
		{{#each courses}}
		<div class="row">
			<div class="span5">

				<!-- This renders the title of the course with options that show on hover -->
				<span id="{{_id}}" class="hover-show h3-edit">
					<h3 class="my-inline">{{title}}</h3>
					<a href="#" class="invisible course-edit"><i class="icon-edit"></i> Edit</a>
					<a href="#" class="invisible course_delete"><i class="icon-trash"></i> Delete</a>
				</span>


				<!-- This renders the exams that belong to a course -->
				<table class="table table-hover">
					{{#each exams}}
					<tr class="hover-show">
						<td><a href="exam/{{_id}}" id="{{_id}}">{{title}} {{year}}</a>
						</td>
						<td><a href="/admin/{{_id}}" class="invisible exam-edit"></t><i class="icon-edit"></i> Edit</a></td>
						<td><a href="#" class="invisible exam_delete"><i class="icon-trash"></i> Delete</td>
						
						<td><a href="#" class="publish-exam-toggle">
							{{#if published}}
							<i class="icon-eye-open"></i> Published
							{{else}}
							<i class="icon-eye-close"></i> Draft
							{{/if}}
						</a></td>
					</tr>
					{{else}}
					<p> No exams on this course. <a href="/edit/{{../title}}"> Add exam</a></p>
					{{/each}}
				</table>
			</div> <!--/.span -->
		</div>	<!--/.row -->
		{{else}}
		<div class="alert alert-info"> You are not registered as admin on any courses yet</div>
		{{/each}} <!--/end courses loop -->
	</div> <!--/.container -->

	<!-- Add course modal-->
	<div id="modal_add_course" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Add new course</h3>
		</div>
		<div class="modal-body">
			<form name="add_course" id="form_addCourse" class="inline">
				<label>Course title</label>
				<input id="input_course_title" type="text" placeholder="example: INF1000">
			</div>
			<div class="modal-footer">
				<button id="cancel_new_course" class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
				<button id ="btn_submit_course" type="submit" class="btn btn-primary">Save course </button>
			</div>
		</form>
	</div> 
	<!--/end Add course modal -->
</template>


<!-- This template generates the view to edit or add a new exam -->
<template name="admin_edit_exam">
	<div class="page-header">
		<h1><span class="text-error">Editing</span> {{title}} {{year}}<small> changes are saved instantly</small></h1>
	</div>
	<div class="container-fluid">
		<div class="row-fluid">
			{{#if title}}
			<div class="span3">
				<div class="well sidebar-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Exercises</li>
						{{#each exercises}}
						{{> admin_sidenav}}
						{{else}}
						<span class="label">No exercises yet</span>
						{{/each}}
					</ul>
				</div>
			</div><!--/span-->
			{{/if}}
			<div class="span9">
				<div class="well row-fluid">
					{{#if title}}
					<span id="{{_id}}" class="hover-show h2-edit">
						<h2 class="my-inline">{{title}}</h2><h2 class="my-inline"> {{year}}</h2>
						<a href="#" class="invisible exam-title-edit"><i class="icon-edit"></i> Edit</a>
					</span>
					<div class="exercises">
						{{#each exercises}}
						{{> admin_exercise}}		
						{{/each}}
						{{> admin_new_exercise}}
					</div>
					{{else}}
					<form name="new_exam" id="form_new_exam">
						<legend>Create new exam</legend>
						<fieldset>
							<label>Exam title</label>
							<input name="title" type="text" id="new_exam_title" autofocus="true" placeholder="Example: Eksamen Høst">
							<label>Year</label>
							<input name="year"class ="input-small" type="number" id="new_exam_year" value="2012">
							<label>Course</label>
							<select name="courseId">
								<option>No course</option>
								{{#each courses}}
								<option value="{{_id}}">{{title}}</option>
								{{/each}}
							</select><br />
							<input type="submit" class="btn btn-primary" value="Save">
						</fieldset>
					</form>
					{{/if}}
				</div><!--/row-->
				<p class="lead">The students <strong>must</strong> learn more. <a href="#form_new_exercise" class="show_add_new_exercise">Add a new exercise</a>
				</p>
			</div><!--/span-->
		</div><!--/row-->
	</div><!--/.fluid-container-->
</template>

<template name="admin_sidenav">
	<li><a href="#{{_id}}" class="exercise">{{number}}: {{title}}</a></li>
</template>

<template name="admin_exercise">
	<span id="{{_id}}" class="hover-show h3-edit extraspace">
		<h3 class="my-inline edit">{{number}}) </h3>
		<h3 class="my-inline replace_edit">{{title}} </h3>
		<h3 class="my-inline replace_edit"><span class="muted">({{points}} points)<span></h3>
		<div class="my-inline change_exercise_links">
			<a href="#" class="invisible exercise-edit"><i class="icon-edit"></i> Edit</a>
			<a href="#" class="invisible exercise_delete"><i class="icon-trash"></i> Delete</a>
		</div>
		<div class="save_exercise_edit none">
			<button type="submit" class="btn btn-primary save_edit_exercise">Save</button>
			<button type="button" class="btn cancel_edit_exercise">Cancel</button>
		</div>
		<div class="hl">
<!-- The lines under here must be left aligned or else text will get spaces inserted :() -->
{{#markdown}}
{{text}}
{{/markdown}}
		</div>
	</span>
</template>

<template name="admin_new_exercise">
	<form name="new_exercise" id ="form_new_exercise" style="display:none">
		<legend>Create new exercise</legend>
		<fieldset>
			<label>Number</label>
			<input name="number" type="number" autofocus="true"  class="input-mini" value="{{next_exercise_number}}">
			<label>Exercise title</label>
			<input name="title" type="text" id="new_exercise_title" placeholder="Example: Find five errors in this script" class="input-large">
			<label>Points</label>
			<input name="points" class ="input-small" type="number" id="new_exercise_points" value="5">
			<label>Text (<a href="http://www.kreatives-chaos.com/markdown_help.html">Markdown syntax</a>)</label>
			<textarea name="text" class="input-block-level" rows="10" id="new_exercise_text"></textarea>
		</fieldset> 
		<div class="form-actions">
			<button type="submit" class="btn btn-primary">Save</button>
			<button type="button" class="btn" id="cancel_new_ex">Cancel</button>
		</div>
	</form>
</template>

