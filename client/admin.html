<!-- This template generates the admin view -->
<template name="admin">
	{{#if edit}}
	{{> admin_edit_exam edit.this}} <!-- Sends the exam object (edit.this as context to the template) -->
	{{else}} <!-- / else if edit -->

	{{#if currentUserLoaded}}
	{{#if isAdmin}}
	{{> examlist_admin}}
	{{else}}
	<div class="alert alert-error alert-block">
		<button type="button" class="close" data-dismiss="alert">×</button>
		<h4>This page is for admins only</h4>
		This user does not have admin rights
	</div>
	{{/if}} <!-- /end ifAdmin if -->
	{{/if}} <!-- /end currentUser if -->

	{{/if}} <!-- /end if edit -->
</template>

<template name="examlist_admin">
	<div class="container">
		<!-- The add content element. This will be fixed to right on desktop, and displayed top on smaller screens -->
		<div class="add-new-content span2 offset10">
			<p class="lead">Add new content</p>
			<a href="#" id="add_new_course" data-toggle="modal" data-target="#modal_add_course">New course</a><br />
			<a href="/admin/newexam" class="add_new_exam">New exam</a>
		</div>
		<!-- /end add-new-content -->
		
		<p class="lead">You are admin on these courses:</p>
		{{#each courses}}
		<div class="row">
			<div class="span5">

				<!-- This renders the title of the course with options that show on hover -->
				<span id="{{_id}}" class="hover-show h3-edit">
					<h3 class="my-inline">{{title}}</h3>
					<a href="#" class="invisible course-edit"><i class="icon-edit"></i> Edit</a>
					<a href="#" class="invisible course_delete"><i class="icon-trash"></i> Delete</a>
				</span>


				<!-- This renders the exams that belong to a course -->
				<table class="table table-hover">
					{{#each exams}}
					<tr class="hover-show">
						<td><a href="exam/{{_id}}" id="{{_id}}">{{title}} {{year}}</a>
						</td>
						<td><a href="/admin/{{_id}}" class="invisible exam-edit"></t><i class="icon-edit"></i> Edit</a></td>
						<td><a href="#" class="invisible exam_delete"><i class="icon-trash"></i> Delete</td>
						
						<td><a href="#" class="publish-exam-toggle">
							{{#if published}}
							<i class="icon-eye-open"></i> Published
							{{else}}
							<i class="icon-eye-close"></i> Draft
							{{/if}}
						</a></td>
					</tr>
					{{else}}
					<p> No exams on this course. <a href="/edit/{{../title}}"> Add exam</a></p>
					{{/each}}
				</table>
			</div> <!--/.span -->
		</div>	<!--/.row -->
		{{/each}} <!--/end courses loop -->
	</div> <!--/.container -->

	<!-- Add course modal-->
	<div id="modal_add_course" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Add new course</h3>
		</div>
		<div class="modal-body">
			<form name="add_course" id="form_addCourse" class="inline">
				<label>Course title</label>
				<input id="input_course_title" type="text" placeholder="example: INF1000">
			</div>
			<div class="modal-footer">
				<button id="cancel_new_course" class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
				<button id ="btn_submit_course" type="submit" class="btn btn-primary">Save course </button>
			</div>
		</form>
	</div> 
	<!--/end Add course modal -->

	<!-- Add exam modal-->
	<div id="modal_add_exam" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3 id="myModalLabel">Add new course</h3>
		</div>
		<div class="modal-body">
			<form name="add_exam" id="form_add_exam" class="inline">
				<label>Course title</label>
				<input id="input_exam_title" type="text" placeholder="example: Eksamen vår 2012">
			</div>
			<div class="modal-footer">
				<button id="cancel_new_exam" class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
				<button id ="btn_submit_exam" type="submit" class="btn btn-primary">Save course </button>
			</div>
		</form>
	</div> 
	<!--/end Add course modal -->
</template>


<!-- This template generates the view to edit or add a new exam -->
<template name="admin_edit_exam">
	<div class="page-header">
		<h1>Editing {{title}} {{year}}<small> changes are saved instantly</small></h1>
	</div>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span3">
				<div class="well sidebar-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Exercises</li>
						{{#each exercises}}
						{{> admin_sidenav}}
						{{/each}}
					</ul>
				</div>
			</div><!--/span-->
			<div class="well span9">
				<div class="row-fluid">
					{{#if title}}
					<span id="{{_id}}" class="hover-show h2-edit">
						<h2 class="my-inline">{{title}}</h2><h2 class="my-inline"> {{year}}</h2>
						<a href="#" class="invisible exam-title-edit"><i class="icon-edit"></i> Edit</a>
					</span>
					{{else}}
					<form name="new_exam" id="form_new_exam">
						<label>Exam title</label>
						<input name="title" type="text" id="new_exam_title" autofocus="true"value="Eksamen Høst">
						<label>Year</label>
						<input name="year"class ="input-small" type="number" id="new_exam_year" value="2012">
						<label>Course</label>
						<select name="courseId">
							<option>No course</option>
							{{#each courses}}
							<option value="{{_id}}">{{title}}</option>
							{{/each}}
						</select><br />
						<input type="submit" class="btn btn-primary" value="Save">
					</form>
					{{/if}}
					<div class="exercises">
						{{#each exercises}}
						{{> admin_exercise}}
						{{/each}}
					</div>
				</div><!--/row-->
			</div><!--/span-->
		</div><!--/row-->
	</div><!--/.fluid-container-->
</template>

<template name="admin_sidenav">
	<li><a href="#{{_id}}" id="{{_id}}" class="exercise">{{number}}: {{title}}</a></li>
</template>

<template name="admin_exercise">
	<h3 class="title">{{number}}) {{title}} <span class="muted">({{points}} points)<span></h3>
	<pre>{{text}}</pre>
</template>

